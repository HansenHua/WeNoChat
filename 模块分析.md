# 需求概述
聊天室软件是互联网时代最常见、应用最广泛的交流方式之一，不仅有每天都在使用的QQ、微信等几乎占据垄断地位的聊天软件，在当前其他业务app中，也经常能找到聊天窗口，可见网络聊天这种高效却低成本的沟通方式与日常生活工作紧密相连。本次 **Wenochat** 聊天软件开发实践是学习了基于Qt的面向对象编程、socket通信、sqlite编程后的综合应用实践，在增强程序设计能力的同时，也为让我们对项目开发流程和项目管理有初步认识。首先聊天室需要具备聊天的基本功能，包括注册/登录，修改个人信息，进行一对一聊天或者群聊，以及获取群聊记录。注册包括获取用户id，自定义用户名、密码、性别、年龄，设置安全问题和答案。对于注册登录安全性，需要有修改密码功能，忘记密码则需要安全问题来找回或者修改密码。
修改个人信息则对注册时的信息均能进行修改。针对一对一聊天，需要好友功能，包括添加、查询、删除好友。类似地，群聊也需要加群、退群。为保证聊天的稳定性，如聊天的一方断线，另一方还在发消息，则还需增加离线缓存功能。除发送基本的文本内容，还可以提供发送其他格式的功能，如markdown等。为满足用户的个性化需求，还可以加入修改头像功能。

需要实现的具体功能模块列举如下：
## 客户端、UI

- 登录界面
  - 登录（向服务端发送**登录请求**）
  - 注册（打开注册界面）
  - 收取客户端的**登录状态信息**并处理
- 注册界面
  - 注册（向服务端发送**注册请求**）
  - 收取服务端的**注册状态信息**并处理
- 主界面
  - 获取好友列表（向服务端发送**好友列表请求**，接收**好友列表**后加入左侧边栏）
  - 发送消息（向服务端发送**聊天信息**）
  - 接收消息（接收并处理服务端发送的**聊天信息**），最好能区分好友和自己
- 断网提醒
上述标黑的地方应该是需要通信协议的地方

## 服务端

- 数据库
  - 数据表设计
  - 数据库接口封装（理论上在服务端应用层不应当出现对数据库直接操作）
- 消息处理（需要处理的消息种类取决于客户端）
  - 登录（返回：登录成功 or 用户不存在 or 密码错误）
  - 注册（返回：注册成功 or 用户名重复）
  - 好友列表（返回：好友列表）
  - 消息
    - 暂时不支持对离线好友发消息（服务端暂存消息其实也能做）
    - 不返回，取出该消息的接收方，向接收方发送该条消息。

## 通信模块

- 通信协议（C：客户端，S：服务端）
  - 登录请求（C->S）
  - 登录状态信息（S->C）
  - 注册请求（C->S）
  - 注册状态信息（S->C）
  - 好友列表请求（C->S）
  - 好友列表（S->C）
  - 聊天信息（C->S，S->C）
- 编码器（编写函数将信息打包，节省不必要的代码量）
- 解码器（编写函数将从服务端收到的信息解包）

## 指令

感觉采用json编码会方便一些

- 指令编码器
- 指令解码器
- 指令类（可以用工厂模式）

目前能想到的指令有：

- Login：登录
- LoginStatus：登录状态
- Register：注册
- RegisterStatus：注册状态
- Message：聊天信息
- GetOnlineUsers：获取在线用户列表
- OnlineUsers：用户在线列表
